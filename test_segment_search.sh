#!/bin/bash

# Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ°
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ: ./test_segment_search.sh

echo "=========================================="
echo "VanitySearch - Ð¢ÐµÑÑ‚ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ°"
echo "=========================================="
echo ""

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°
if [ ! -f "./VanitySearch" ]; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: VanitySearch Ð½Ðµ ÑÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½"
    echo "Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: make all"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
if [ ! -f "segments_puzzle71.txt" ]; then
    echo "âš ï¸  ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ: segments_puzzle71.txt Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
fi

echo "âœ… VanitySearch Ð½Ð°Ð¹Ð´ÐµÐ½"
echo ""

# Ð¢ÐµÑÑ‚ 1: Ð’Ñ‹Ð²Ð¾Ð´ ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸
echo "ðŸ“‹ Ð¢ÐµÑÑ‚ 1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð¾Ð²Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð² ÑÐ¿Ñ€Ð°Ð²ÐºÐµ"
echo "-------------------------------------------"
./VanitySearch -h 2>&1 | grep -E "(seg|bits)" && echo "âœ… ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ -seg Ð¸ -bits Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚" || echo "âŒ ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
echo ""

# Ð¢ÐµÑÑ‚ 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²ÐµÑ€ÑÐ¸Ð¸
echo "ðŸ“‹ Ð¢ÐµÑÑ‚ 2: Ð’ÐµÑ€ÑÐ¸Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹"
echo "-------------------------------------------"
./VanitySearch -v
echo ""

# Ð¢ÐµÑÑ‚ 3: Ð—Ð°Ð¿ÑƒÑÐº Ñ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸ (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ°)
echo "ðŸ“‹ Ð¢ÐµÑÑ‚ 3: Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð¾Ð¼ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸"
echo "-------------------------------------------"
echo "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°..."

cat > test_segments.txt << 'EOF'
# Ð¢ÐµÑÑ‚Ð¾Ð²Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
# ÐÐµÐ±Ð¾Ð»ÑŒÑˆÐ¸Ðµ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ñ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸
50.0 50.1 up test_segment_1
50.2 50.3 up test_segment_2
EOF

echo "âœ… Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» ÑÐ¾Ð·Ð´Ð°Ð½: test_segments.txt"
echo ""

echo "Ð—Ð°Ð¿ÑƒÑÐº Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð° (5 ÑÐµÐºÑƒÐ½Ð´)..."
echo "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°: timeout 5s ./VanitySearch -seg test_segments.txt -bits 71 -t 2 1Test 2>/dev/null"
echo ""

if command -v timeout > /dev/null 2>&1; then
    timeout 5s ./VanitySearch -seg test_segments.txt -bits 71 -t 2 1Test 2>/dev/null || true
    echo ""
    echo "âœ… Ð¢ÐµÑÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½ (Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ñ‡ÐµÑ€ÐµÐ· 5 ÑÐµÐº)"
else
    echo "âš ï¸  ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° timeout Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°, Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ‚ÐµÑÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ"
fi

echo ""

# Ð¢ÐµÑÑ‚ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
echo "ðŸ“‹ Ð¢ÐµÑÑ‚ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²"
echo "-------------------------------------------"

echo "Ð¢ÐµÑÑ‚ 4a: -seg Ð±ÐµÐ· -bits (Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð²Ñ‹Ð´Ð°Ñ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÑƒ)"
./VanitySearch -seg test_segments.txt 1Test 2>&1 | grep -i "error" && echo "âœ… Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚" || echo "âš ï¸  Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð½Ðµ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð°"
echo ""

echo "Ð¢ÐµÑÑ‚ 4b: -bits Ð±ÐµÐ· -seg (Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð² Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ)"
./VanitySearch -bits 71 -v 2>&1 > /dev/null && echo "âœ… Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð±ÐµÐ· ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð¾Ð²" || echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°"
echo ""

# Ð¢ÐµÑÑ‚ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°
echo "ðŸ“‹ Ð¢ÐµÑÑ‚ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸"
echo "-------------------------------------------"

cat > test_formats.txt << 'EOF'
# Ð¢ÐµÑÑ‚ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð²
45.0 54.0 up segment_with_name
59.0 54.0 down
48.0 52.0 UP uppercase_direction
# ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹
51.0 53.0 Ð²Ð½Ð¸Ð· russian_direction
EOF

echo "âœ… Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ñ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°Ð¼Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½"
echo ""

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ°
echo "ðŸ§¹ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
rm -f test_segments.txt test_formats.txt

echo ""
echo "=========================================="
echo "Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾!"
echo "=========================================="
echo ""
echo "ðŸ“š Ð”Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ:"
echo "   - SEGMENT_SEARCH_README_RU.md"
echo "   - segments_config_example.txt"
echo "   - segments_puzzle71.txt"
echo ""
echo "ðŸš€ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð´Ð»Ñ Puzzle 71:"
echo "   ./VanitySearch -seg segments_puzzle71.txt -bits 71 -gpu -t 8 1FshYo"
echo ""

